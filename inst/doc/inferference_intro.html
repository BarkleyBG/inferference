<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="date" content="2016-09-03" />

<title>inferference Vignette</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<style type="text/css">
  p.abstract{
    text-align: center;
    font-weight: bold;
  }
  div.abstract{
    margin: auto;
    width: 90%;
  }
</style>


<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore"><code>inferference</code> Vignette</h1>
<h4 class="author"><em>Bradley Saul</em></h4>
<address class="author_afil">
University of North Carolina<br><h4 class="author"><em>Michael Hudgens</em></h4>
<address class="author_afil">
University of North Carolina<br><h4 class="date"><em>2016-09-03</em></h4>
<div class="abstract">
<p class="abstract">Abstract</p>
In causal inference, interference occurs when the treatment of one subject affects the outcome of other subjects. Interference can distort research conclusions about causal effects when not accounted for properly. In the absence of interference, inverse probability weighted (IPW) estimators are commonly used to estimate causal effects from observational data. Recently, IPW estimators have been extended to handle interference.  proposed IPW methods to estimate direct and indirect (or spillover) effects that allow for interference between individuals within groups. In this paper, we present , an  package that computes these IPW causal effect estimates when interference may be present within groups. We illustrate use of the package with examples from political science and infectious disease.
</div>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Interference occurs when the treatment (or exposure) of one subject affects the outcome of other subjects . Without accounting for interference, measuring only a treatment’s direct effect may be misleading. For example, a vaccine’s direct effect on an individual in a group with a large proportion of vaccinated individuals can be small. However, the protective, indirect effect from other group members’ vaccinations may be large. In this case the vaccine may be judged to be ineffective based on the direct effect despite possibly having great public health utility due to the indirect effect . Other areas where interference may be present include criminology , developmental psychology , econometrics , education , imaging , political science , social media and network analysis , sociology , and spatial analyses .</p>
<p>Inverse probability weighted (IPW) methods are often used to estimate causal effects when interference is absent . Recent developments have extended IPW estimators to estimate causal effects when interference may be present in either randomized or observational studies.  proposed estimators for observational studies assuming partial interference , i.e., individuals can be partitioned into groups where there may be interference between individuals in the same group but not between individuals in different groups. Partial interference could be reasonable, for example, in study of bovine disease where physical separation of herds precludes pathogen transmission between herds. On the other hand, if birds or farm workers could spread the pathogen between herds, then partial interference may be questionable. The  IPW estimators require a model for the group-level propensity score (i.e., the probability of a group’s observed treatment allocation). The large sample properties of these estimators were derived by .</p>
<p>To date, software for analysis of causal effects in the presence of interference is limited. Without interference, the   package  provides tools to compute IPW estimators . Existing interference-related  packages, including   and  , were designed for analysis of randomized experiments. In this paper, we present the  package  which computes the  IPW estimators and the large sample variance estimators developed by .</p>
<p>The outline for the remainder of this paper is as follows. The next section provides background on interference and an overview of the mathematical concepts and notation. Section  describes the package’s main features. Sections  and  demonstrate the software with examples from public health and political science. The example in Section  shows advanced features of the package. We discuss computational issues with IPW estimators when groups have large numbers of individuals in Section . We conclude with a brief discussion and future directions in Section .</p>
</div>
<div id="preliminaries" class="section level1">
<h1>Preliminaries</h1>
<div id="a-brief-history-of-interference" class="section level2">
<h2>A Brief History of Interference</h2>
<p>Much of causal inference assumes that the exposure of one individual does not affect the outcomes of other individuals, i.e., there is no interference between individuals.  bundled no interference with the assumption that treatments for all units are comparable (no hidden forms of treatment) into the “Stable Unit Treatment Value Assumption” (SUTVA). Despite sporadic efforts, the research community gave little attention to this assumption until the early 2000s. One approach to relaxing the no interference assumption is to assume partial interference. Under this assumption, space, time, and/or social network groupings preclude interference between individuals in different groups, but interference may occur within a group.</p>
<p>, , and  developed methods based on the assumption of partial interference to estimate causal effects in the presence of interference. When an experimenter randomizes units – by design – at the group and individual levels,  defined estimators that, under certain assumptions, are unbiased for a treatment’s direct and indirect (or spillover) effects.</p>
<p>Observational studies complicate estimation of interference effects.  proposed IPW estimators of causal effects based on group-level propensity scores for non-randomized treatment allocation. They showed these estimators to be unbiased when the propensity score is known.  derived the large sample properties of these estimators when the propensity scores are unknown but correctly modeled. They applied these results to draw inference about the direct and indirect effects of cholera vaccination in Matlab, Bangladesh.</p>
</div>
<div id="basic-partial-interference-setup" class="section level2">
<h2>Basic partial interference setup</h2>
<p>Consider <span class="math inline">\(N\)</span> individuals partitioned into <span class="math inline">\(m\)</span> groups, each with <span class="math inline">\(n_i\)</span> individuals for <span class="math inline">\(i = 1, \dots, m\)</span>. The triplet <span class="math inline">\((Y_{ij}, A_{ij}, \mathbf{X}_{ij})\)</span> represents the observed outcome, treatment, and baseline covariate vector, respectively, for individual <span class="math inline">\(j\)</span> in group <span class="math inline">\(i\)</span>. We let capitalized letters denote random variables, and lowercase letters (e.g., <span class="math inline">\((y_{ij}, a_{ij}, \mathbf{x}_{ij})\)</span>) denote observed or realized values. Let <span class="math inline">\(\mathbf{X}_{i}\)</span> and <span class="math inline">\(\mathbf{A}_i\)</span> be the matrix of baseline covariates and vector of treatment allocations for members of group <span class="math inline">\(i\)</span>. Let <span class="math inline">\(\mathbf{A}_{i,-j} = (A_{i1}, \dots, A_{ij-1}, A_{ij+1}, \dots, A_{in_i})\)</span> represent a group’s treatment allocation excluding the <span class="math inline">\(j\)</span>th subject. Let <span class="math inline">\(Y_{ij}(a_{ij}, \mathbf{a}_{i,-j}) = Y_{ij}(\mathbf{a}_i)\)</span> be the potential outcome for individual <span class="math inline">\(j\)</span> in group <span class="math inline">\(i\)</span> if, possibly contrary to fact, group <span class="math inline">\(i\)</span> received <span class="math inline">\(\mathbf{a}_i\)</span>. By causal consistency, <span class="math inline">\(Y_{ij} = Y_{ij}(\mathbf{A}_i)\)</span> . Let <span class="math inline">\(\mathbf{Y}_i\)</span> be the vector of potential outcomes for group <span class="math inline">\(i\)</span>. By assuming no interference between groups, an individual’s potential outcome may depend only on the treatment allocation of its group. The set <span class="math inline">\(\mathcal{A}(n_i)\)</span> contains all of group <span class="math inline">\(i\)</span>’s possible treatment vectors. With a binary treatment, <span class="math inline">\(A_{ij} \in \{a_1, a_2\}\)</span>, this set has <span class="math inline">\(2^{n_i}\)</span> elements.</p>
<div id="estimands" class="section level3">
<h3>Estimands</h3>
<p>Without interference, researchers often estimate an average treatment effect, which contrasts the average outcome for two treatment allocations: the entire population treated versus the entire population untreated. With interference, causal estimands may be defined in terms of the continuum of treatment allocation strategies between those extremes. In , we consider Bernoulli-type allocation strategies proposed by , where individuals independently receive treatment with probability <span class="math inline">\(\alpha\)</span>. For this allocation strategy, the probability of a group’s treatment vector is denoted as <span class="math inline">\(\pi_{i}(\mathbf{A}_i; \alpha) = \prod_{j = 1}^{n_i} \alpha^{A_{ij}}(1 - \alpha)^{1 - A_{ij}}\)</span> and, excluding the <span class="math inline">\(j\)</span>th subject, <span class="math inline">\(\pi_{i}(\mathbf{A}_{i, -j}; \alpha) = \prod_{k = 1, k \neq j}^{n_i} \alpha^{A_{ik}}(1 - \alpha)^{1 - A_{ik}}.\)</span> The analyst may compute the estimators described below over a range of <span class="math inline">\(\alpha\)</span>’s to explore hypothetical underlying treatment allocations. In their analysis of a cholera vaccine study,  examined strategies between <span class="math inline">\(\alpha = 0.3\)</span> and <span class="math inline">\(\alpha = 0.6\)</span> because 75% of the groups had observed vaccine coverages in that range.</p>
<p>Define an individual’s average potential outcome when assigned treatment <span class="math inline">\(a\)</span> under strategy <span class="math inline">\(\alpha\)</span> by</p>
<p><span class="math display">\[
\overline{Y}_{ij}(a; \alpha) = \sum_{\mathbf{a}_{i, -j} \in \mathcal{A}(n_i - 1)} Y_{ij}(a, \mathbf{a}_{i, -j}) \pi_i(\mathbf{a}_{i, -j}; \alpha).
\]</span></p>
<p>In words, <span class="math inline">\(\overline{Y}_{ij}(a; \alpha)\)</span> is a weighted average of individual <span class="math inline">\(j\)</span>’s potential outcomes under possible treatment vectors of the other <span class="math inline">\(n_{i} - 1\)</span> subjects in group <span class="math inline">\(i\)</span> weighted by the probability of each treatment vector. Similarly, define the marginal individual average potential outcome by</p>
<p><span class="math display">\[
\overline{Y}_{ij}(\alpha) = \sum_{\mathbf{a}_{i} \in \mathcal{A}(n_i)} Y_{ij}(\mathbf{a}_{i}) \pi_i(\mathbf{a}_{i}; \alpha).
\]</span></p>
<p>Here, the weighted average of individual <span class="math inline">\(j\)</span>’s potential outcomes is across all group treatment vectors in <span class="math inline">\(\mathcal{A}(n_i)\)</span>.</p>
<p>A simple mean of individual average potential outcomes within a cluster defines group average potential outcomes. Then group-level estimands are averaged to make population-level estimands. For example, <span class="math inline">\(\overline{Y}(a; \alpha) = \sum_{i = 1}^m \{\sum_{j = 1}^{n_i} \overline{Y}_{ij}(a; \alpha)/n_i \} /m\)</span> is the population-level average outcome when individuals receive treatment <span class="math inline">\(a\)</span> and their group adopts allocation strategy <span class="math inline">\(\alpha\)</span>. Likewise, <span class="math inline">\(\overline{Y}(\alpha) = \sum_{i = 1}^m \{ \sum_{j = 1}^{n_i} \overline{Y}_{ij}(\alpha)/n_i \} /m\)</span> is the population-level average outcome when groups adopt allocation strategy <span class="math inline">\(\alpha\)</span>.</p>
<p>Contrasts of the population average potential outcomes define causal effects.  describe four causal effects: direct, indirect, total, and overall . The direct (or unit-level treatment) effect compares average potential outcomes within a single allocation strategy:</p>
<p><span class="math display">\[
\overline{DE}(\alpha) = \overline{Y}(a_1; \alpha)  - \overline{Y}(a_2; \alpha).
\]</span></p>
<p>An indirect effect compares a treatment’s average potential outcomes under different allocation strategies:</p>
<p><span class="math display">\[
\overline{IE}(\alpha, \alpha') = \overline{Y}(a_1; \alpha)  - \overline{Y}(a_1; \alpha'). 
\]</span></p>
<p>For a binary treatment, there are two indirect effects for a fixed <span class="math inline">\((\alpha, \alpha')\)</span> pair: one for <span class="math inline">\(a_1\)</span> and one for <span class="math inline">\(a_2\)</span>. If interference is not present, then the indirect effect equals zero. The total effect accounts for both the direct and indirect effects:</p>
<p><span class="math display">\[
\overline{TE}(\alpha, \alpha') = \overline{Y}(a_1; \alpha)  - \overline{Y}(a_2; \alpha'). 
\]</span></p>
<p>The overall effect contrasts the marginal average potential outcomes for two allocation strategies:</p>
<p><span class="math display">\[
\overline{OE}(\alpha, \alpha') = \overline{Y}(\alpha)  - \overline{Y}(\alpha'). 
\]</span></p>
<p>See  and  for further discussion of these causal estimands.</p>
</div>
</div>
<div id="ipw-estimation" class="section level2">
<h2>IPW estimation</h2>
<p> proposed IPW estimators of the causal estimands defined above assuming partial interference. Their estimator weights an individual’s outcome by the inverse of the group-level propensity score, <span class="math inline">\(\Pr(\mathbf{A}_i | \mathbf{X}_i)\)</span>, the probability of a group’s treatment allocation given the covariates of the group’s individuals.  showed the IPW estimators to be unbiased when the group-level propensities are known, under the following assumptions:</p>
<ol style="list-style-type: decimal">
<li>Conditional Independence: <span class="math inline">\(\Pr(\mathbf{A}_i = \mathbf{a}_i | \mathbf{X}_i, \mathbf{Y}_i) = \Pr(\mathbf{A}_i = \mathbf{a}_i | \mathbf{X}_i)\)</span></li>
<li>Positivity: <span class="math inline">\(\Pr(\mathbf{A}_i = \mathbf{a}_i | \mathbf{X}_i) &gt; 0 \quad \forall \mathbf{a}_i \in \mathcal{A}(n_i)\)</span></li>
</ol>
<p>The true propensity scores are not generally known in observational studies and must be estimated.  suggested estimating <span class="math inline">\(\Pr(\mathbf{A}_i | \mathbf{X}_i)\)</span> using a generalized mixed effects model. We denote these models as <span class="math inline">\(f_{\mathbf{A}_i | \mathbf{X}_i}(\mathbf{A}_i | \mathbf{X}_i; \boldsymbol{\theta}_x, \theta_s)\)</span>, where <span class="math inline">\(\boldsymbol{\theta}_x\)</span> represents fixed effects parameters and <span class="math inline">\(\theta_s\)</span> a group random effect parameter. Model parameters may be estimated by maximum likelihood methods, which we denote <span class="math inline">\(\widehat{\boldsymbol{\theta}} = (\hat{\boldsymbol{\theta}}_x, \hat{\theta}_s)\)</span>. For a binary treatment, a model for the group’s propensity score might be:</p>
\begin{equation} \label{eq:propensity}
f_{\mathbf{A}_i | \mathbf{X}_i}(\mathbf{A}_i | \mathbf{X}_i; \boldsymbol{\theta}_x, \theta_s) = \int \prod_{j = 1}^{n_i} h_{ij}(b_i; \boldsymbol{\theta}_x)^{A_{ij}} \{ 1 - h_{ij}(b_i; \boldsymbol{\theta}_x) \}^{1 - A_{ij}} f_b(b_i; \theta_s) db_i 
\end{equation}
<p>where <span class="math inline">\(h_{ij}(b_i; \boldsymbol{\theta}_x) = \Pr(A_{ij} = 1 | \mathbf{X}_{ij}, b_i, \boldsymbol{\theta}_x) = \mbox{logit}^{-1}(\mathbf{X}_{ij}\boldsymbol{\theta}_x + b_i)\)</span> and <span class="math inline">\(f_b(\cdot; \theta_s)\)</span> is the density of a Normal random variable with mean 0 and variance <span class="math inline">\(\theta_s\)</span>. This is the default group-level propensity score model in ; the examples below show how the user can modify the default group propensity score model. Validity of inferences drawn using the methods described below requires correct specification of the group propensity score model. Therefore, it is important in practice to conduct diagnostics to assess the fit of the model employed. For example, if  is assumed, then the  diagnostic test can be used to assess whether the random effects are Normally distributed.</p>
<p>The IPW estimator for the group-level average potential outcomes is a straightforward weighted sum,</p>
\begin{equation} \label{eq:ipw}
\widehat{Y}_i^{ipw}(a, \alpha) = \frac{\sum_{j = 1}^{n_i} \pi_i(\mathbf{A}_{i, -j}; \alpha) I(A_{ij} = a) Y_{ij} }{n_i f_{\mathbf{A}_i | \mathbf{X}_i}(\mathbf{A}_i | \mathbf{X}_i; \widehat{\boldsymbol{\theta}})   },
\end{equation}
<p>as is the estimator for group-level marginal potential outcomes,</p>
\begin{equation} \label{eq:marg_ipw}
\widehat{Y}_i^{ipw}(\alpha) = \frac{\sum_{j = 1}^{n_i} \pi_i(\mathbf{A}_{i}; \alpha) Y_{ij} }{n_i  f_{\mathbf{A}_i | \mathbf{X}_i}(\mathbf{A}_i | \mathbf{X}_i;\widehat{\boldsymbol{\theta}})   }.
\end{equation}
<p>From  and , one constructs population-level average potential outcome and marginal population-level average potential outcome estimators by <span class="math inline">\(\widehat{Y}^{ipw}(a; \alpha) = \sum_{i = 1}^m \widehat{Y}_i^{ipw}(a; \alpha)/m\)</span> and <span class="math inline">\(\widehat{Y}^{ipw}(\alpha) = \sum_{i = 1}^m \widehat{Y}_i^{ipw}(\alpha)/m\)</span>. Estimators for direct, indirect, total, and overall effects simply contrast population-level estimators,</p>
\begin{align*}
\widehat{DE}(\alpha) &amp;= \widehat{Y}^{ipw}(a_1; \alpha) - \widehat{Y}^{ipw}(a_2; \alpha)  \\
\widehat{IE}(\alpha, \alpha') &amp;= \widehat{Y}^{ipw}(a_1; \alpha) - \widehat{Y}^{ipw}(a_1; \alpha')  \\
\widehat{TE}(\alpha, \alpha') &amp;= \widehat{Y}^{ipw}(a_1; \alpha) - \widehat{Y}^{ipw}(a_2; \alpha')  \\
\widehat{OE}(\alpha, \alpha') &amp;= \widehat{Y}^{ipw}(\alpha) - \widehat{Y}^{ipw}(\alpha').
\end{align*}
<div id="ipw-variance-estimation" class="section level3">
<h3>IPW variance estimation</h3>
<p> derived asymptotic distributions of the IPW estimators using standard estimating equation theory. Briefly, the IPW estimators above are consistent and asymptotically Normal as the number of groups <span class="math inline">\(m\)</span> tends to infinity. When the group-level propensity scores are known (as in the case of simulation or randomized studies), a large sample estimator of the variance of <span class="math inline">\(\widehat{DE}(\alpha)\)</span> is</p>
<p><span class="math display">\[
\frac{1}{m^2}\sum_{i = 1}^m \left\{\widehat{DE}_i(\alpha) - \widehat{DE}(\alpha) \right\}^2 \; .
\]</span></p>
<p>Results for <span class="math inline">\(\widehat{IE}\)</span>, <span class="math inline">\(\widehat{TE}\)</span>, and <span class="math inline">\(\widehat{OE}\)</span> are analogous. As explained below, when  in the  function, this formula is used to compute standard errors and Wald-type confidence intervals.</p>
<p>When the propensity scores are unknown and instead estimated using a parametric model, computing variance estimators is more complicated and involves derivatives of the group propensity with respect to each parameter and derivatives of the propensity model’s log likelihood. The supplementary materials in  contain the mathematical details, and this method is available with the  option. The  option computes consistent variance estimates which account for the estimation of the weights, whereas the  option computes variance estimates described in the preceding paragraph which ignore estimation of the weights and are conservative (i.e., tend to be too large).</p>
</div>
</div>
</div>
<div id="using-inferference" class="section level1">
<h1>Using inferference</h1>
<div id="users-guide" class="section level2">
<h2>User’s guide</h2>
<p>To start, install the package from CRAN using . The list below details the arguments for , the primary function in . Special attention should be given to the  and  arguments.</p>
<ul>
<li>: formula used to define the causal model.  has a minimum of 4 parts, separated by  and  in a specific structure: . The order matters, and the pipes () split the data frame into corresponding pieces . The  piece is passed as a single formula to the chosen  (defined below) used to estimate or fix propensity parameters.
<ul>
<li>The following includes a random effect for the group: . In this instance, the group variable appears twice.</li>
<li>If the study design includes a `participation’ variable (as in both examples below), this is easily added to the formula: .</li>
</ul></li>
<li>: a function, which may be created by the user, used to compute the IP weights. This defaults to the function , which calculates the product of inverse logits for individuals in a group: <span class="math inline">\(\prod_{j = 1}^{n_i} \{r h_{ij}(b_i)\}^{A_{ij}}\{1 - r h_{ij}(b_i)\}^{1 - A_{ij}} f_b(b_i; \theta_s)\)</span>, where <span class="math inline">\(h_{ij}(b_i) = \mbox{logit}^{-1}(\mathbf{X}_{ij}\theta_x + b_i)\)</span>, <span class="math inline">\(b_i\)</span> is a group-level random effect, <span class="math inline">\(f_b\)</span> is a <span class="math inline">\(N(0, \theta_s)\)</span> density, and <span class="math inline">\(r\)</span> is a known constant. In an observational study typically <span class="math inline">\(r = 1\)</span>. The examples below include individual randomized experiments in which case <span class="math inline">\(r\)</span> denotes the randomization probability among trial participants.  is the integrand of  where <span class="math inline">\(h_{ij}(b_i)\)</span> is scaled by a constant <span class="math inline">\(r\)</span> term. If no random effect is included in the ,  ignores the random effect. IP weights are computed by numerically integrating  over the random effect distribution using by  to which arguments may be passed via  (see below). The default  also takes the following argument that can be passed via the  argument in :
<ul>
<li>: a scalar. This is the <span class="math inline">\(r\)</span> in the formula just above. It defaults to 1 in the case that a  vector is not included. The vaccine study example in Section  demonstrates use of this argument.</li>
</ul></li>
<li>: a function, which may be created by the user, that defines the log likelihood of the propensity score model. This should generally be the same function as , which is the default.</li>
<li>: a vector of values in <span class="math inline">\([0, 1]\)</span>. These are the <span class="math inline">\(\alpha\)</span>’s defined in Section . Increasing the number of elements of the allocation vector increases computation time; however, a larger number of allocations will make plotted effect estimates smoother. A minimum of two allocations is required.</li>
<li>: the analysis data frame. This must include all the variables defined in the .</li>
<li>: the method used to estimate or set the propensity model parameters. Must be one of , , or . For a fixed effects only model use , or to include random effects use ’s  .  only supports a single random effect for the grouping variable, corresponding to <span class="math inline">\(b_i\)</span>. When the propensity parameters are known (as in simulations) or if estimating parameters for the propensity model outside of , use the  option. See  for details on how to pass the oracle parameters. Defaults to .</li>
<li>: a list of options passed to the function in . Defaults to . When , the list must have two elements,  and . If the model does not include random effects, set .</li>
<li>: currently only supports and defaults to .</li>
<li>: a list with a single item , which is either  or . See Section  for details. Defaults to .</li>
<li>: level for confidence intervals. Defaults to .</li>
<li>: a scalar multiplication factor by which to rescale outcomes and effects. Defaults to .</li>
<li>: indicator of whether the integrand function uses the allocation parameter. Defaults to TRUE.</li>
<li>: used to pass additional arguments to internal functions such as  or . Arguments can also be passed to the  and  functions.</li>
</ul>
</div>
<div id="the-interference-object" class="section level2">
<h2>The interference object</h2>
<p>An  call results in an  object of class  which contains:</p>
<ul>
<li>: a data frame of causal effect estimates;</li>
<li>: the  or  object;</li>
<li>: a list of objects summarizing the causal model such as the number of groups, number of allocations, and the formula used in the  call;</li>
<li>: (# of groups) <span class="math inline">\(\times\)</span> (# of allocations) matrix of group-level weights: <span class="math display">\[
w_{i, k} = \frac{\pi_i(\mathbf{A}_i; \alpha_k)}{f_{\mathbf{A}_i|\mathbf{X}_i}(\mathbf{A}_i|\mathbf{X}_i; \hat{\boldsymbol{\theta}})}.
\]</span></li>
</ul>
<p>If , then the object also includes:</p>
<ul>
<li>: (# of groups) <span class="math inline">\(\times\)</span> (# of allocations) <span class="math inline">\(\times\)</span> (# of parameters) array of weights computed using derivatives of the propensity function with respect to each parameter;</li>
<li>: (# of groups) <span class="math inline">\(\times\)</span> (# of parameters) matrix of derivatives of the log likelihood.</li>
</ul>
</div>
<div id="utility-functions" class="section level2">
<h2>Utility functions</h2>
<p>The package includes tools to extract effect estimates of interest from the  object. The functions ,  (or ),  (or ), and  (or ) select appropriate records from the  data frame in the  object. Section  shows an example.</p>
</div>
</div>
<div id="example-vaccine-study" class="section level1">
<h1>Example: Vaccine Study</h1>
<p>This section illustrates the use of  with an example drawn from vaccine research. The package includes a single dataset based on the same set of parameters used in the simulation study by . The  dataset consists of 3000 units in 250 groups and contains two covariates ( = age in decades and  = distance to river), a vaccination indicator (), a participation indicator (), a binary outcome () indicating cholera infection (1 yes, 0 no), and the unit’s .</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">library</span>(inferference)
&gt;<span class="st"> </span><span class="kw">head</span>(vaccinesim)</code></pre></div>
<pre><code>##   Y        X1       X2 A B group
## 1 1 5.3607405 1.715527 0 0     1
## 2 0 0.1964597 1.730802 0 1     1
## 3 0 0.4846243 1.769546 1 1     1
## 4 0 0.8012977 1.715527 0 1     1
## 5 0 2.1426629 1.772158 1 1     1
## 6 0 1.2861017 1.715527 0 1     1</code></pre>
<p>Like the original study  that inspired the simulation, individuals were randomized to vaccine with a known probability of <span class="math inline">\(2/3\)</span>, but subjects could opt to not participate in the trial. In essence, there are both experimental and observational aspects to the data. The  function handles this design when ’s  argument is used and a participation variable is included in the formula.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>example1 &lt;-<span class="st"> </span><span class="kw">interference</span>(
+<span class="st">     </span><span class="dt">formula =</span> Y |<span class="st"> </span>A |<span class="st"> </span>B ~<span class="st"> </span>X1 +<span class="st"> </span>X2 +<span class="st"> </span>(<span class="dv">1</span>|group) |<span class="st"> </span>group, 
+<span class="st">     </span><span class="dt">allocations =</span> <span class="kw">c</span>(.<span class="dv">3</span>, .<span class="dv">45</span>,  .<span class="dv">6</span>), 
+<span class="st">     </span><span class="dt">data =</span> vaccinesim, 
+<span class="st">     </span><span class="dt">randomization =</span> <span class="dv">2</span>/<span class="dv">3</span>,
+<span class="st">     </span><span class="dt">method =</span> <span class="st">'simple'</span>)</code></pre></div>
<p>The only arguments required for  to run are , , and . When using the  method (the default) to compute the variance, the internal workings call   and  frequently. The option  greatly speeds up the  function. For more accurate derivatives, leave out this option. See  for more options.</p>
<p>The  function provides an overview of the causal effect estimates, estimated standard errors, and Wald-type confidence intervals. In the output,  and  refer to <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\alpha'\)</span>, while  and  refer to <span class="math inline">\(a_1\)</span> and <span class="math inline">\(a_2\)</span>, respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">print</span>(example1)</code></pre></div>
<pre><code>##  --------------------------------------------------------------------------
##                                Model Summary                    
##  --------------------------------------------------------------------------
##  Formula: Y | A | B ~ X1 + X2 + (1 | group) | group 
##  Number of groups:  250 
##  3 allocations were used from 0.3 (min) to 0.6 (max) 
##  --------------------------------------------------------------------------
##                           Causal Effect Summary                            
##                          Confidence level: 0.95                       
##                          Variance method: robust        
##  --------------------------------------------------------------------------
## 
##  Direct Effects
##  alpha1 trt1 alpha2 trt2 estimate std.error conf.low conf.high
##    0.30    0   0.30    1   0.1605   0.02474  0.11202    0.2090
##    0.60    0   0.60    1   0.1086   0.01857  0.07219    0.1450
##    0.45    0   0.45    1   0.1339   0.01778  0.09904    0.1687
## 
##  Indirect Effects
##  alpha1 trt1 alpha2 trt2 estimate std.error conf.low conf.high
##    0.30    0   0.60    0  0.15907   0.02617  0.10777    0.2104
##    0.30    0   0.45    0  0.08657   0.01732  0.05263    0.1205
##    0.45    0   0.60    0  0.07250   0.01408  0.04490    0.1001
## 
##  Total Effects 
##  alpha1 trt1 alpha2 trt2 estimate std.error conf.low conf.high
##    0.30    0   0.60    1   0.2677   0.02435   0.2199    0.3154
##    0.30    0   0.45    1   0.2205   0.02469   0.1721    0.2688
##    0.45    0   0.60    1   0.1811   0.01841   0.1450    0.2172
## 
##  Overall Effects 
##  alpha1 trt1 alpha2 trt2 estimate std.error conf.low conf.high
##    0.30   NA   0.60   NA  0.17607  0.019247  0.13835    0.2138
##    0.30   NA   0.45   NA  0.09867  0.014207  0.07083    0.1265
##    0.45   NA   0.60   NA  0.07740  0.008981  0.05980    0.0950
## 
##  --------------------------------------------------------------------------</code></pre>
<p>The utility functions return selected effect estimates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">direct_effect</span>(example1, .<span class="dv">3</span>)</code></pre></div>
<pre><code>##   alpha1 trt1 alpha2 trt2  estimate  std.error  conf.low conf.high
## 1    0.3    0    0.3    1 0.1605036 0.02473782 0.1120184 0.2089888</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">ie</span>(example1, .<span class="dv">3</span>)</code></pre></div>
<pre><code>##   alpha1 trt1 alpha2 trt2   estimate  std.error   conf.low conf.high
## 1    0.3    0   0.30    0 0.00000000 0.00000000 0.00000000 0.0000000
## 2    0.3    0   0.45    0 0.08656992 0.01731878 0.05262574 0.1205141
## 3    0.3    0   0.60    0 0.15906887 0.02617398 0.10776882 0.2103689</code></pre>
<div id="plotting-effect-estimates" class="section level2">
<h2>Plotting effect estimates</h2>
<p>Plots of effect estimates over a range of <span class="math inline">\(\alpha\)</span> levels may be helpful in summarizing results.  present several such graphical displays. Here we demonstrate how to generate similar plots of effect estimates using .</p>
<p>First, we estimate the effects over a dense sequence of allocations so that lines will be smooth.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>example2 &lt;-<span class="st"> </span><span class="kw">interference</span>( <span class="dt">formula =</span> Y |<span class="st"> </span>A |<span class="st"> </span>B ~<span class="st"> </span>X1 +<span class="st"> </span>X2 +<span class="st"> </span>(<span class="dv">1</span>|group) |<span class="st"> </span>group, 
+<span class="st">     </span><span class="dt">allocations =</span> <span class="kw">seq</span>(.<span class="dv">2</span>, .<span class="dv">8</span>, <span class="dt">by =</span> .<span class="dv">01</span>), 
+<span class="st">     </span><span class="dt">data =</span> vaccinesim, <span class="dt">randomization =</span> <span class="dv">2</span>/<span class="dv">3</span>, <span class="dt">method =</span> <span class="st">'simple'</span>)</code></pre></div>
<p>In Figure , we present the direct and indirect effect estimates over this range of allocations. For direct effects, a simple scatterplot showing the point-wise confidence intervals suffices. One approach with indirect effects fixes <span class="math inline">\(\alpha\)</span> and plots estimates over a range of <span class="math inline">\(\alpha'\)</span>, whereas a contour plot displays all pairwise <span class="math inline">\((\alpha, \alpha')\)</span> comparisons over a range of allocation strategies.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>deff &lt;-<span class="st"> </span><span class="kw">direct_effect</span>(example2)
&gt;<span class="st"> </span>x &lt;-<span class="st"> </span>deff$alpha1
&gt;<span class="st"> </span>y &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(deff$estimate)
&gt;<span class="st"> </span>u &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(deff$conf.high)
&gt;<span class="st"> </span>l &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(deff$conf.low)
&gt;<span class="st"> </span><span class="kw">plot</span>(<span class="kw">c</span>(<span class="kw">min</span>(x), <span class="kw">max</span>(x)), <span class="kw">c</span>(-.<span class="dv">15</span>, .<span class="dv">25</span>), <span class="dt">type =</span> <span class="st">'n'</span>, <span class="dt">bty =</span> <span class="st">'l'</span>,
+<span class="st">      </span><span class="dt">xlab =</span> <span class="kw">expression</span>(alpha), <span class="dt">ylab =</span> <span class="st">''</span> )
&gt;<span class="st"> </span><span class="kw">title</span>(<span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">widehat</span>(DE) *<span class="st"> &quot;(&quot;</span> *<span class="st"> </span>alpha *<span class="st"> &quot;)&quot;</span>),
+<span class="st">       </span><span class="dt">line =</span> <span class="dv">2</span>)
&gt;<span class="st"> </span><span class="kw">polygon</span>(<span class="kw">c</span>(x, <span class="kw">rev</span>(x)), <span class="kw">c</span>(u, <span class="kw">rev</span>(l)), <span class="dt">col =</span> <span class="st">'skyblue'</span>, <span class="dt">border =</span> <span class="ot">NA</span>)
&gt;<span class="st"> </span><span class="kw">lines</span>(x, y, <span class="dt">cex =</span> <span class="dv">2</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>ieff<span class="fl">.4</span> &lt;-<span class="st"> </span><span class="kw">ie</span>(example2, <span class="dt">allocation1 =</span> .<span class="dv">4</span>)
&gt;<span class="st"> </span>x &lt;-<span class="st"> </span>ieff<span class="fl">.4</span>$alpha2
&gt;<span class="st"> </span>y &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(ieff<span class="fl">.4</span>$estimate)
&gt;<span class="st"> </span>u &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(ieff<span class="fl">.4</span>$conf.high)
&gt;<span class="st"> </span>l &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(ieff<span class="fl">.4</span>$conf.low)
&gt;<span class="st"> </span><span class="kw">plot</span>(<span class="kw">c</span>(<span class="kw">min</span>(x), <span class="kw">max</span>(x)),<span class="kw">c</span>(-.<span class="dv">15</span>, .<span class="dv">25</span>), <span class="dt">type =</span> <span class="st">'n'</span>, <span class="dt">bty =</span> <span class="st">'l'</span>,
+<span class="st">      </span><span class="dt">xlab =</span> <span class="kw">expression</span>(alpha *<span class="st"> &quot;'&quot;</span>), <span class="dt">ylab =</span> <span class="st">''</span>)
&gt;<span class="st"> </span><span class="kw">title</span>(<span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">widehat</span>(IE) *<span class="st"> &quot;(&quot;</span> *<span class="st"> </span><span class="fl">0.4</span> *<span class="st"> &quot;,&quot;</span> *<span class="st"> </span>alpha *<span class="st"> &quot;'&quot;</span> *<span class="st"> &quot;)&quot;</span>),
+<span class="st">       </span><span class="dt">line =</span> <span class="dv">2</span>)
&gt;<span class="st"> </span><span class="kw">polygon</span>(<span class="kw">c</span>(x, <span class="kw">rev</span>(x)), <span class="kw">c</span>(u, <span class="kw">rev</span>(l)), <span class="dt">col =</span> <span class="st">'skyblue'</span>, <span class="dt">border =</span> <span class="ot">NA</span>)
&gt;<span class="st"> </span><span class="kw">lines</span>(x, y, <span class="dt">cex =</span> <span class="dv">2</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>ieff &lt;-<span class="st"> </span><span class="kw">subset</span>(example2[[<span class="st">&quot;estimates&quot;</span>]], effect ==<span class="st"> 'indirect'</span>)
&gt;<span class="st"> </span>x &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(ieff$alpha1))
&gt;<span class="st"> </span>y &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(ieff$alpha2))
&gt;<span class="st"> </span>z &lt;-<span class="st"> </span><span class="kw">xtabs</span>(estimate ~<span class="st"> </span>alpha1 +<span class="st"> </span>alpha2, <span class="dt">data=</span> ieff)
&gt;<span class="st"> </span><span class="kw">contour</span>(x, y, z, <span class="dt">xlab =</span> <span class="kw">expression</span>(alpha), 
+<span class="st">         </span><span class="dt">ylab =</span> <span class="kw">expression</span>(alpha *<span class="st"> &quot;'&quot;</span>), <span class="dt">bty =</span> <span class="st">'l'</span>)</code></pre></div>
\begin{figure}[ht]
\centering
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[]{jss_inferference_files/figure-latex/deff_plot-1.pdf}
\end{minipage}\\
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[]{jss_inferference_files/figure-latex/ieff_plot-1.pdf}
\end{minipage}%
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[]{jss_inferference_files/figure-latex/ieff_contour-1.pdf}
\end{minipage}
 \caption{Plots of the estimates from \code{example2}. The top plot shows the direct effect estimates. The bottom two plots demonstrate different ways of viewing the indirect effect estimates. The shaded regions show the point-wise 95\% confidence intervals}
  \label{fig:plots}
\end{figure}
</div>
<div id="diagnostics" class="section level2">
<h2>Diagnostics</h2>
<p>IPW estimators are known to be unstable if the weights range greatly. The package includes a basic utility to check the performance of the group-level weights, <span class="math inline">\(w_{i,k}\)</span>, for multiple allocations. The function  plots histograms of weights for chosen allocation levels. If the  argument is left , the function plots histograms for five allocation levels used the  call. Figure  shows the resulting histogram for a single allocation. The analyst should examine groups with extreme weights, which may unduly influence population-level estimates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">diagnose_weights</span>(example2, <span class="dt">allocations =</span> .<span class="dv">5</span>, <span class="dt">breaks =</span> <span class="dv">30</span>)</code></pre></div>
\begin{figure}[ht]
\centering
 \includegraphics[width=8cm]{jss_inferference_files/figure-latex/diagnostic-1.pdf}
 \caption{A histogram of group-level weights, $w_{i,k}$, for $\alpha_k = 0.2$.}
  \label{fig:diagnostics}
\end{figure}
</div>
</div>
<div id="example-voting-experiment" class="section level1">
<h1>Example: Voting Experiment</h1>
<p>The preceding example used the default  function to define the group-level propensities. The following example demonstrates how to customize the propensity score function.</p>
<p> reported an experiment on voter behavior to examine peer-to-peer indirect effects on voting participation. The experiment randomized households with only two registered voters in Denver and Minneapolis to receive one of three assignments: voting encouragement, recycling encouragement, or nothing. Canvassers knocked on doors of households randomized to the voting or recycling groups a week before the 2002 primary. If a registered voter answered the door, the canvassers delivered a scripted message about voting (treatment) or recycling (control). The researchers used voter turnout records to determine if each member of the household then voted in the election. Nickerson was interested in the potential spillover effect of the voting encouragement to the untreated individual via the treated individual. From analysis of the observed data, he concluded there was a “secondary effect” where the household members not contacted by the canvassers voted more often in the treatment groups compared to the control groups.</p>
<p>The dataset  contains information for 3861 households, 2549 in Denver and 1312 in Minneapolis, including covariates such as age, gender, previous voting history, and party affiliation. Our estimand of interest involves average voting outcomes when households receive voting encouragement compared to when household receive the recycling message, hence we exclude households not contacted by canvassers. We also exclude the single household where a canvasser appears to have contacted both registered voters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>voters &lt;-<span class="st">  </span><span class="kw">within</span>(voters, {
+<span class="st">     </span>treated     =<span class="st"> </span>(treatment ==<span class="st"> </span><span class="dv">1</span> &amp;<span class="st"> </span>reached ==<span class="st"> </span><span class="dv">1</span>) *<span class="st"> </span><span class="dv">1</span> 
+<span class="st">     </span>c_age       =<span class="st"> </span>(age -<span class="st"> </span><span class="kw">mean</span>(age))/<span class="dv">10</span> 
+<span class="st">    </span>})
&gt;<span class="st"> </span>reach_cnt &lt;-<span class="st"> </span><span class="kw">tapply</span>(voters$reached, voters$family, sum)
&gt;<span class="st"> </span>voters &lt;-<span class="st"> </span>voters[!(voters$family %in%<span class="st"> </span><span class="kw">names</span>(reach_cnt[reach_cnt &gt;<span class="st"> </span><span class="dv">1</span>])), ]
&gt;<span class="st"> </span>voters &lt;-<span class="st"> </span>voters[voters$hsecontact ==<span class="st"> </span><span class="dv">1</span>, ]</code></pre></div>
<div id="household-level-propensity" class="section level2">
<h2>Household-level propensity</h2>
<p>Unlike the vaccine study example, in this data set randomization occurred at the group level but individual level treatment was not randomized. With only two subjects, <span class="math inline">\(\mathbf{A}_i = (A_{i1}, A_{i2})\)</span> is the treatment allocation for group <span class="math inline">\(i\)</span> and <span class="math inline">\(\mathbf{X}_i = (\mathbf{X}_{i1}, \mathbf{X}_{i2})\)</span> is the matrix of individuals’ covariate matrices for group <span class="math inline">\(i\)</span>. Let <span class="math inline">\(\mathbf{B}_i = (B_{i1}, B_{i2})\)</span> be indicators of being reached by a canvasser in group <span class="math inline">\(i\)</span>. Since we only consider households where someone answered the door, <span class="math inline">\(\mathbf{B}_i \in \{(1, 0), (0, 1)\}\)</span> and <span class="math inline">\(\Pr(B_{i1} = 1| \mathbf{X}_{i}) + \Pr(B_{i2} = 1| \mathbf{X}_{i}) = 1\)</span>. Let <span class="math inline">\(h_{ij} = \Pr(B_{ij} = 1| \mathbf{X}_{i}; \theta) = \mbox{logit}^{-1}(\mathbf{X}_{i}\theta_x)\)</span>. Let <span class="math inline">\(G_i \in \{0, 1\}\)</span> be the indicator that group <span class="math inline">\(i\)</span> is randomized to treatment (1) or control (0). By design, <span class="math inline">\(\Pr(G_i = 1) = 0.5\)</span>. Since <span class="math inline">\(\Pr(A_{i1} | \mathbf{X}_i; \theta) = 1 - \Pr(A_{i2} | \mathbf{X}_i; \theta)\)</span>, <span class="math inline">\(\Pr(\mathbf{A}_i | \mathbf{X}_i; \theta)\)</span> can arbitrarily be defined in terms of either household member. By convention we use the first subject (subject one) of each group found in the dataset. Among treated groups, the probability of subject one being treated is the probability that a canvasser reached subject one. That is, <span class="math inline">\(\Pr(A_{i1} | G_{i} = 1, \mathbf{X}_i; \theta) = h_{i1}^{A_{i1}}(1 - h_{i1})^{1 - A_{i1}}\)</span>. Thus, the group-level propensity can be expressed:</p>
\begin{align*}
\Pr(\mathbf{A}_i | \mathbf{X}_i ; \theta) &amp;= \Pr(\mathbf{A}_i | G_i = 1, \mathbf{X}_i ; \theta)\Pr(G_i = 1) + \Pr(\mathbf{A}_i | G_i = 0, \mathbf{X}_i ; \theta)\Pr(G_i = 0) \\
&amp;= 0.5 \{ \Pr(\mathbf{A}_i | G_i = 1, \mathbf{X}_i ; \theta) +   \Pr(\mathbf{A}_i | G_i = 0, \mathbf{X}_i ; \theta) \} \\
&amp;= \begin{cases}
.5 &amp; \text{if $A_{i1} = 0, A_{i2} = 0$ and $G_i = 0$} \\
.5 h_{i1}^{A_{i1}}(1 - h_{i1})^{1 - A_{i1}} &amp; \text{if ($A_{i1} = 0, A_{i2} = 1$ or $A_{i1} = 1, A_{i2} = 0$) and $G_i = 1$}  \\
0  &amp; \text{otherwise}
\end{cases} \\
\end{align*}
<p>Thus, <span class="math inline">\(h_{i1}\)</span> is sufficient to determine the group-level propensity. If we know whether or not the first subject was reached by a canvasser, then we know if the second was. Therefore, we can estimate parameters for <span class="math inline">\(h_{i1}\)</span> with a dataset that includes only subject one from each group. To do this, we must estimate the parameters outside of  and use . We include centered age (in decades) in the propensity model for demonstration purposes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>voters1 &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, <span class="kw">by</span>(voters, voters[, <span class="st">'family'</span>], function(x) x[<span class="dv">1</span>, ]))
&gt;<span class="st"> </span>coef.voters &lt;-<span class="st"> </span><span class="kw">coef</span>(<span class="kw">glm</span>(reached ~<span class="st"> </span>c_age, <span class="dt">data =</span> voters1, 
+<span class="st">                      </span><span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">'logit'</span>)))</code></pre></div>
</div>
<div id="coding-the-propensity-function" class="section level2">
<h2>Coding the propensity function</h2>
<p>Custom  and  functions must have at least one argument:</p>
<ul>
<li>: the first argument is the variable for which the  function computes the integral. As in this example, the function can be written so that the integral evaluates to 1 and has no effect.</li>
</ul>
<p>For example, the following function will fix the group-level propensity to 0.5 for all groups when :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>fixed_propensity &lt;-<span class="st"> </span>function(b){
+<span class="st">   </span><span class="kw">return</span>(<span class="fl">0.5</span> *<span class="st"> </span><span class="kw">dnorm</span>(b)) 
+<span class="st"> </span>}</code></pre></div>
<p>For more realistic models, additional arguments may be passed to the custom function:</p>
<ul>
<li>: the covariate matrix (determined by the ) for the <span class="math inline">\(i\)</span>th group</li>
<li>: the vector of treatment indicators for the <span class="math inline">\(i\)</span>th group</li>
<li>: vector of estimated parameters from the </li>
<li>: the allocation level for which the propensity is currently being estimated</li>
<li>: other arguments can be passed via the ellipsis in </li>
</ul>
<p>Now we have the pieces to write the propensity function for the voting example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>household_propensity &lt;-<span class="st"> </span>function(b, X, A, 
+<span class="st">                                  </span>parameters, 
+<span class="st">                                  </span><span class="dt">group.randomization =</span> .<span class="dv">5</span>){
+<span class="st">   </span>if(!<span class="kw">is.matrix</span>(X)){
+<span class="st">     </span>X &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(X)
+<span class="st">   </span>}
+<span class="st">   </span>if(<span class="kw">sum</span>(A) ==<span class="st"> </span><span class="dv">0</span>){ 
+<span class="st">     </span>pr &lt;-<span class="st">  </span>group.randomization
+<span class="st">   </span>} else { 
+<span class="st">     </span>X<span class="fl">.1</span> &lt;-<span class="st"> </span>X[<span class="dv">1</span> ,]; A<span class="fl">.1</span> &lt;-<span class="st"> </span>A[<span class="dv">1</span>] 
+<span class="st">     </span>h   &lt;-<span class="st"> </span><span class="kw">plogis</span>(X<span class="fl">.1</span> %*%<span class="st"> </span>parameters)
+<span class="st">     </span>pr  &lt;-<span class="st">  </span>group.randomization *<span class="st"> </span><span class="kw">dbinom</span>(A<span class="fl">.1</span>, <span class="dv">1</span>, h)
+<span class="st">   </span>}
+<span class="st">   </span>out &lt;-<span class="st"> </span>pr *<span class="st"> </span><span class="kw">dnorm</span>(b) 
+<span class="st">   </span>out
+<span class="st"> </span>}</code></pre></div>
</div>
<div id="evidence-of-a-peer-influence-effect" class="section level2">
<h2>Evidence of a peer influence effect</h2>
<p>The influence of the door opener on the non-door opener’s voting behavior corresponds to an indirect effect. Though the Bernoulli-type parametrization of the estimands allows us to look at a range of allocations, <span class="math inline">\(\widehat{IE}(0.5, 0)\)</span> makes the sensible comparison between a world where individuals receive a voting message with probability <span class="math inline">\(0.5\)</span> to a world where individuals have zero probability of receiving the voting message.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>example3 &lt;-<span class="st"> </span><span class="kw">interference</span>(
+<span class="st">   </span><span class="dt">formula =</span> voted02p |<span class="st"> </span>treated |<span class="st"> </span>reached ~<span class="st"> </span>c_age |<span class="st"> </span>family,
+<span class="st">   </span><span class="dt">propensity_integrand =</span> <span class="st">'household_propensity'</span>,
+<span class="st">   </span><span class="dt">data =</span> voters,
+<span class="st">   </span><span class="dt">model_method =</span> <span class="st">'oracle'</span>, 
+<span class="st">   </span><span class="dt">model_options =</span> <span class="kw">list</span>(<span class="dt">fixed.effects =</span> coef.voters, <span class="dt">random.effects =</span> <span class="ot">NULL</span>),
+<span class="st">   </span><span class="dt">allocations   =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>),
+<span class="st">   </span><span class="dt">integrate_allocation =</span> <span class="ot">FALSE</span>,
+<span class="st">   </span><span class="dt">causal_estimation_options =</span> <span class="kw">list</span>(<span class="dt">variance_estimation =</span> <span class="st">'robust'</span>),
+<span class="st">   </span><span class="dt">conf.level =</span> .<span class="dv">9</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">ie</span>(example3, .<span class="dv">5</span>, <span class="dv">0</span>)[ , <span class="kw">c</span>(<span class="st">'estimate'</span>, <span class="st">'conf.low'</span>, <span class="st">'conf.high'</span>)]</code></pre></div>
<pre><code>##     estimate    conf.low  conf.high
## 1 0.03151501 0.002290586 0.06073944</code></pre>
<p>The point estimate suggests an individual receiving the voting encouragement increases the voting likelihood of the other household member by 3.2%. The 90% confidence interval excludes zero, indicating a significant indirect effect corroborating the analysis in .</p>
<p>For comparison, suppose that a flip of a fair coin determined which registered voter opened the door. We exclude age as a covariate and instead set <span class="math inline">\(h_{i1} = 0.5\)</span>. Here we assume to know the propensity score, so we use .</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>example4 &lt;-<span class="st"> </span><span class="kw">interference</span>(
+<span class="st">   </span><span class="dt">formula =</span> voted02p |<span class="st"> </span>treated |<span class="st"> </span>reached ~<span class="st"> </span><span class="dv">1</span> |<span class="st"> </span>family,
+<span class="st">   </span><span class="dt">propensity_integrand =</span> <span class="st">'household_propensity'</span>,
+<span class="st">   </span><span class="dt">data =</span> voters,
+<span class="st">   </span><span class="dt">model_method =</span> <span class="st">'oracle'</span>,
+<span class="st">   </span><span class="dt">model_options =</span> <span class="kw">list</span>(<span class="dt">fixed.effects =</span> <span class="dv">0</span>, <span class="dt">random.effects =</span> <span class="ot">NULL</span>),
+<span class="st">   </span><span class="dt">allocations   =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>),
+<span class="st">   </span><span class="dt">integrate_allocation =</span> <span class="ot">FALSE</span>,
+<span class="st">   </span><span class="dt">causal_estimation_options =</span> <span class="kw">list</span>(<span class="dt">variance_estimation =</span> <span class="st">'naive'</span>),
+<span class="st">   </span><span class="dt">conf.level =</span> .<span class="dv">9</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">ie</span>(example4, .<span class="dv">5</span>, <span class="dv">0</span>)[ , <span class="kw">c</span>(<span class="st">'estimate'</span>, <span class="st">'conf.low'</span>, <span class="st">'conf.high'</span>)]</code></pre></div>
<pre><code>##     estimate    conf.low  conf.high
## 1 0.03144654 0.002209019 0.06068406</code></pre>
<p>Examining the group-level weights may help diagnose coding errors in the propensity score function. In the case of a fixed probability as in , the propensity weights are easily computed by hand. For example, for <span class="math inline">\(\alpha = 0.5\)</span>,</p>
<p><span class="math display">\[
w_i = \frac{\pi(\mathbf{A}_i; 0.5)}{f_{\mathbf{A}_i | \mathbf{X}_i}(\mathbf{A}_i | \mathbf{X}_i; \theta = 0)} = \begin{cases}
\frac{0.5^2}{.5} = .5 &amp; \text{ if } G_i = 0 \\
\frac{0.5^2}{.5^2} = 1 &amp; \text{ if } G_i = 1\\
 \end{cases},
\]</span></p>
<p>which we can confirm the software computed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>G &lt;-<span class="st"> </span><span class="kw">tapply</span>(voters[<span class="dv">1</span>:<span class="dv">12</span>, <span class="st">'treated'</span>], voters[<span class="dv">1</span>:<span class="dv">12</span>, <span class="st">'family'</span>], sum)
&gt;<span class="st"> </span>W &lt;-<span class="st"> </span><span class="kw">head</span>(example4[[<span class="st">&quot;weights&quot;</span>]])[, <span class="dv">2</span>]
&gt;<span class="st"> </span><span class="kw">cbind</span>(G, W)</code></pre></div>
<pre><code>##    G   W
## 2  1 1.0
## 4  0 0.5
## 5  0 0.5
## 6  0 0.5
## 9  1 1.0
## 10 0 0.5</code></pre>
</div>
</div>
<div id="computational-issues-with-ipw-estimators" class="section level1">
<h1>Computational Issues with IPW Estimators</h1>
<p>We show in this section how computation of the group-level weights may affect estimation as the number of individuals in groups grows. To illustrate, consider the IPW estimator of the overall effect, which weights individual outcomes in group <span class="math inline">\(i\)</span> with:</p>
<p><span class="math display">\[
w_{1i} = \frac{\pi(\textbf{A}_i ; \alpha)}{f_{\mathbf{A}_i | \mathbf{X}_i}(\mathbf{A}_i | \mathbf{X}_i; \hat{\boldsymbol{\theta}})} = \frac{\prod_{j=1}^{n_i} \alpha^{A_{ij}} (1 - \alpha)^{1 - A_{ij}}}{ \int \prod_{j=1}^{n_i} h_{ij}^{A_{ij}} (1 - h_{ij})^{1 - A_{ij}}  f_b (b_i ; \hat{\theta}_s) db_i  }
\]</span></p>
<p>or equivalently, <span class="math display">\[
w_{2i} = \left\{ \int \prod_{j=1}^{n_i} \left(\frac{h_{ij}}{\alpha}\right)^{A_{ij}} \left(\frac{1 - h_{ij}}{1 - \alpha}\right)^{1 - A_{ij}}  f_b (b_i ; \hat{\theta}_s) db_i  \right\}^{-1}
\]</span></p>
<p>or, <span class="math display">\[
w_{3i} = \left\{ \int \exp\left[ \sum_{j=1}^{n_i} \left\{ A_{ij} \log \left( \frac{h_{ij}}{\alpha}\right) + (1 - A_{ij})\log \left(\frac{1 - h_{ij}}{1 - \alpha}\right) \right\} \right] f_b (b_i ; \hat{\theta}_s) db_i \right\}^{-1}. 
\]</span></p>
<p>While mathematically equivalent, these weights may be computationally dissimilar. In the case of <span class="math inline">\(w_{1i}\)</span>, the product term within the integral entails multiplying probabilities and thus will tend to 0 as <span class="math inline">\(n_i\)</span> increases, causing the denominator of <span class="math inline">\(w_{1i}\)</span> to get arbitrarily large. In contrast, the product term in <span class="math inline">\(w_{2i}\)</span> entails multiplying values which may be less than or greater than 1 and thus tends to be less susceptible to numerical instability. Summing <span class="math inline">\(\log(h_{ij}/\alpha)\)</span> or <span class="math inline">\(\log(1 - h_{ij})/(1 - \alpha))\)</span> and then exponentiating the result may provide greater numerical stability. Internally,  uses <span class="math inline">\(w_{3i}\)</span>.</p>
<p>When group sizes are small, the differences between these weights tend to be infinitesimal, but as group sizes grow the differences become important. To be specific, consider the code below comparing <span class="math inline">\(w_{1i}\)</span>, <span class="math inline">\(w_{2i}\)</span>, and <span class="math inline">\(w_{3i}\)</span> for increasing group sizes where <span class="math inline">\(\alpha = 0.5\)</span>, all units are treated, there is no random effect, and <span class="math inline">\(h_{ij}\)</span> is fixed at <span class="math inline">\(0.5\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>compare_weights &lt;-<span class="st"> </span>function(n, <span class="dt">alpha =</span> .<span class="dv">5</span>, <span class="dt">h =</span> .<span class="dv">5</span>){
+<span class="st">   </span>pi  &lt;-<span class="st"> </span><span class="kw">rep</span>(alpha, n)
+<span class="st">   </span>PrA &lt;-<span class="st"> </span><span class="kw">rep</span>(h, n)
+<span class="st">   </span><span class="kw">c</span>(<span class="dt">w1 =</span> <span class="kw">prod</span>(pi)/<span class="kw">prod</span>(PrA),
+<span class="st">     </span><span class="dt">w2 =</span> <span class="dv">1</span>/<span class="kw">prod</span>(PrA/pi),
+<span class="st">     </span><span class="dt">w3 =</span> <span class="dv">1</span>/<span class="kw">exp</span>(<span class="kw">sum</span>(<span class="kw">log</span>(PrA/pi))))  
+<span class="st"> </span>}
&gt;<span class="st"> </span>
<span class="er">&gt;</span><span class="st"> </span>n &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">1074</span>, <span class="dv">1075</span>, <span class="dv">10000</span>)
&gt;<span class="st"> </span><span class="kw">cbind</span>(n, <span class="kw">t</span>(<span class="kw">sapply</span>(n, <span class="dt">FUN =</span> compare_weights)))</code></pre></div>
<pre><code>##          n  w1 w2 w3
## [1,]    50   1  1  1
## [2,]   100   1  1  1
## [3,]   500   1  1  1
## [4,]  1074   1  1  1
## [5,]  1075 NaN  1  1
## [6,] 10000 NaN  1  1</code></pre>
<p>For group sizes up to <span class="math inline">\(1074\)</span> there is no difference, but when <span class="math inline">\(n\)</span> reaches <span class="math inline">\(1075\)</span>, <span class="math inline">\(w_{1i}\)</span> returns  while <span class="math inline">\(w_{2i}\)</span> and <span class="math inline">\(w_{3i}\)</span> correctly return 1.</p>
<p> used <span class="math inline">\(w_{1i}\)</span> to calculate weights, but 15 groups in their analysis had over 1000 subjects. These groups had missing values for weights for all the values of <span class="math inline">\(\alpha\)</span> considered and were excluded from computing the average IPW estimate. Rather than computing the average IPW across 700 groups, they inadvertently took the average across 685 groups. Correcting the estimates by using <span class="math inline">\(w_{2i}\)</span> or <span class="math inline">\(w_{3i}\)</span> did not alter the conclusions in this case, but analysts should be aware of this issue when dealing with large groups.</p>
</div>
<div id="discussion" class="section level1">
<h1>Discussion</h1>
<p>The  package  computes inverse probability weighted estimators of causal effects in the presence of interference. The package currently supports the IPW methods of  and . These methods require a model for the group-level propensity scores. The package provides useful defaults for the propensity models but allows for non-standard models.</p>
<p>Development and application of statistical methods for inferring causal effects in the presence of interference is an active area of research. Future versions of  may incorporate other estimation methods, such as doubly robust methods and stratification. Also, additional methods for estimating variances and effect bounds may be incorporated into the software.</p>
\section*{Acknowledgments}
<p>We would like to thank Carolina Perez-Heydrich (Meredith College) for sharing code from her analysis, which made debugging and validation much smoother. David Nickerson (University of Notre Dame) graciously agreed to share and distribute the voting experiment data in the  package. Steve Cole (UNC), Brian Barkley (UNC), Betz Halloran (University of Washington), Wen Wei Loh (UNC), and Mary Kirk Wilkinson provided helpful comments. This work was partially supported by NIH grant R01 AI085073. The content is solely the responsibility of the authors and does not necessarily represent the official views of the National Institutes of Health.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
